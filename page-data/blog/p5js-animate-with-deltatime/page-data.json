{
    "componentChunkName": "component---src-templates-blog-post-template-js",
    "path": "/blog/p5js-animate-with-deltatime/",
    "result": {"data":{"markdownRemark":{"html":"<p><figure class='gatsby-resp-image-figure' style=''>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; '>\n      <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 66.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABa6o3ZWIE/8QAGBABAAMBAAAAAAAAAAAAAAAAAQACAxH/2gAIAQEAAQUCtpWqPSYttNg4T//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/AWf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAEQECECH/2gAIAQEABj8C6OMU2Fn/xAAbEAABBAMAAAAAAAAAAAAAAAABABARITFRkf/aAAgBAQABPyGFT4hiwFg4i92hRG//2gAMAwEAAgADAAAAEO//AP/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EAE//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/EB2f/8QAGhABAQADAQEAAAAAAAAAAAAAAREAECExkf/aAAgBAQABPxB8xQqiT7idUKaiTBsAnvB5husO19XX/9k='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='A photo by https://unsplash.com/photos/UAvYasdkzq8' title='A photo by https://unsplash.com/photos/UAvYasdkzq8' src='/static/937b9c6f05919424338384fa0e400267/e5166/thumb.jpg' srcset='/static/937b9c6f05919424338384fa0e400267/f93b5/thumb.jpg 300w,\n/static/937b9c6f05919424338384fa0e400267/b4294/thumb.jpg 600w,\n/static/937b9c6f05919424338384fa0e400267/e5166/thumb.jpg 1200w,\n/static/937b9c6f05919424338384fa0e400267/d9c39/thumb.jpg 1800w,\n/static/937b9c6f05919424338384fa0e400267/df51d/thumb.jpg 2400w,\n/static/937b9c6f05919424338384fa0e400267/814d6/thumb.jpg 6144w' sizes='(max-width: 1200px) 100vw, 1200px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>A photo by https://unsplash.com/photos/UAvYasdkzq8</figcaption>\n  </figure></p>\n<h2>What's wrong with <code class=\"language-text\">frameCount</code> or frame-based animation?</h2>\n<p>Here is what I (and probably some of you) have been doing when creating animation with p5js or Processing. Say, I want to use the <code class=\"language-text\">sin()</code> function to control the x position of an ellipse. I need a variable to update the angle of the sine function. Because I want to quickly see the result, I usually use <code class=\"language-text\">frameCount</code> system variable. This variable increments by 1 every frame. Then I multiply some number to <code class=\"language-text\">frameCount</code> until I get the speed that I like.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>frameCount <span class=\"token operator\">*</span> <span class=\"token number\">0.05</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n  <span class=\"token function\">ellipse</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This approach may be fine for quick and simple experiments, but there is a very important problem here. The speed the ellipse is moving on your screen may not be the same speed the users see on <em>their</em> screens. In other words, the <em>frame rate</em> that your sketch is running at may not be the same depending on the devices and also the complexity of your sketch.</p>\n<p>Relying on <code class=\"language-text\">frameCount</code> works great if you can <em>control</em> the frame rate. Pre-rendered videos are a great example. You export frames out of your program to create a video with a fixed frame rate (ie. 24fps or 30fps). But in the interactive context such as web or video games, you can never be sure of the frame rate. It depends on the users' device - it could be a brand new MacbookPro or a ten year-old netbook. Also, if your software dynamically generates a lot of graphic elements in real time, it will eventually burden even a powerful machine.</p>\n<p>The p5js will try to run your sketch at 60 frames per second by default, but it's not a guarantee. You can check the current frame rate by calling <code class=\"language-text\">frameRate()</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">frameRate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You will see the frame rate shifts quite a bit, therefore, it's not a reliable metric to use when determining the timing of your animation. Then how can we ensure that our animation plays at the same speed no matter the frame rate or the device people use? We have to use the delta time.</p>\n<h2>What is delta time?</h2>\n<p>The delta time represents the time it takes between rendering the previous frame and the current frame. Now, we have to think of the speed in terms of time, instead of frames.</p>\n<p>For example, if you have a circle that moves 400 pixels in 1 second, it will move 6.666 pixel (400px/60frames) per frame at 60 frames per second, and will move 13.333 pixel (400px/30frames) per frame at 30 fps. It now covers different distance each frame based on the frame rate, but they will all reach the same destination in 1 second.</p>\n<p>Okay, then how do we apply this concept in a p5js sketch?</p>\n<h2>How to use deltaTime in p5js?</h2>\n<p>If you were to implement the delta time yourself, this is how it will look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> last\n<span class=\"token keyword\">let</span> angle\n<span class=\"token keyword\">let</span> dt\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n  last <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// returned in milliseconds</span>\n  angle <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// calculate delta time (dt)</span>\n  <span class=\"token keyword\">const</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  dt <span class=\"token operator\">=</span> now <span class=\"token operator\">-</span> last\n  last <span class=\"token operator\">=</span> now\n  \n  <span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// convert ms to sec. (this is optional)</span>\n  dt <span class=\"token operator\">*=</span> <span class=\"token number\">0.001</span>\n\n  <span class=\"token comment\">// use dt in animation update</span>\n  angle <span class=\"token operator\">+=</span> dt <span class=\"token operator\">*</span> <span class=\"token number\">5</span>\n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>angle<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n  <span class=\"token function\">ellipse</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the code above, <code class=\"language-text\">new Date().getTime()</code> will return you the number of milliseconds since Jan 1, 1970. If you are curious, <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime\">check out more info on MDN</a>. Then, in the <code class=\"language-text\">draw()</code> loop, we compare the current time to the last time to get the delta time or <code class=\"language-text\">dt</code>. Converting milliseconds to seconds is optional. I dot it because I prefer to count the time in seconds.</p>\n<p>And now we can use <code class=\"language-text\">dt</code> whenever we update our animation. <code class=\"language-text\">angle += dt * 5</code> means for each frame, the angle will update by 5. So 5 is the speed of the angle updating. Change it to 10 and it will update twice faster.</p>\n<p>In fact, this approach of using the delta time is important enough that the p5js library provides us with the system variable called <code class=\"language-text\">deltaTime</code>, which does exactly the same thing as what we've done above. If you're interested in, check out <a href=\"https://github.com/processing/p5.js/blob/5d4fd14e57a0102448dbd0231bd031a4016b137c/src/core/main.js#L383\">the p5js source code</a> for how it's implemented.</p>\n<p>So let's rewrite our example by using this <code class=\"language-text\">deltaTime</code> variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> angle\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n  angle <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  <span class=\"token function\">background</span><span class=\"token punctuation\">(</span><span class=\"token number\">220</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// convert ms to sec. (this is optional)</span>\n  <span class=\"token keyword\">const</span> dt <span class=\"token operator\">=</span> deltaTime <span class=\"token operator\">*</span> <span class=\"token number\">0.001</span>\n\n  <span class=\"token comment\">// use dt in animation update</span>\n  angle <span class=\"token operator\">+=</span> dt <span class=\"token operator\">*</span> <span class=\"token number\">5</span>\n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> width<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>angle<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n  <span class=\"token function\">ellipse</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our code is more compact and there are less things to worry about. With this approach, animation may look choppy if the current frame rate is too low, but you can be sure that the time it takes for the same animation will always be the same.</p>\n<h2>Conclusion</h2>\n<p>You have to think in <em>time</em>, not in <em>frames</em>. Instead of thinking about how much my circle will move in a frame, start thinking about how much it will move in a second. Again, this works in situations where you cannot control the frame rate. In a more traditional settings like hand-drawn or After Effects animation, you can control the frame rate so frame-based animation will work great. Also, if you go into physics simulation such as collision detection, then you will need a more advanced solution than the simple <code class=\"language-text\">deltaTime * speed</code>. I may write another post about that when I get a chance later.</p>\n<p>If you liked my post, please follow me to get more stories like this. I write about creative coding for artists and designers. Thank you for reading and hope this was helpful!</p>","excerpt":"What's wrong with  or frame-based animation? Here is what I (and probably some of you) have been doing when creating animation with p5js or…","frontmatter":{"slug":"/blog/p5js-animate-with-deltatime/","title":"A Better Way to Animate With deltaTime in p5js","subtitle":"Still using frameCount for your animation?","date":"January 08, 2022","tags":["p5js","javascript","animation","creative coding"],"featuredImage":{"publicURL":"/static/937b9c6f05919424338384fa0e400267/thumb.jpeg"}}}},"pageContext":{"slug":"/blog/p5js-animate-with-deltatime/"}},
    "staticQueryHashes": ["1139398070","1696241065"]}