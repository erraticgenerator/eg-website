{
    "componentChunkName": "component---src-templates-blog-post-template-js",
    "path": "/blog/tensorflow-metal-intel-mac-gpu/",
    "result": {"data":{"markdownRemark":{"html":"<p><figure class='gatsby-resp-image-figure' style=''>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; '>\n      <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABnUtmLERsK//EABkQAAMBAQEAAAAAAAAAAAAAAAECAwQAEf/aAAgBAQABBQJqv0QKZ6ZJuz5pF/BNA3f/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8BBbC//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/AVC1v//EABwQAAICAwEBAAAAAAAAAAAAAAABAhESITFRkf/aAAgBAQAGPwKsn9IKXM9lxbivEi2ulJaGf//EABkQAQADAQEAAAAAAAAAAAAAAAEAESFBUf/aAAgBAQABPyGwrFRtS9hC08nAhaIxuvF5KwZ4MiOANn//2gAMAwEAAgADAAAAEP8AL//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQMBAT8QUwsOLf/EABkRAAIDAQAAAAAAAAAAAAAAAAABESFh8P/aAAgBAgEBPxBBLJLSrtP/xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMUFRcf/aAAgBAQABPxC8/wAwD37rMoW1Asv6mcAACBz3c5VFQivs0yC0KLlokiBbw7v/2Q=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='Photo by https://unsplash.com/@huntleytography' title='Photo by https://unsplash.com/@huntleytography' src='/static/31958cb12c7783308ab97975cce20703/e5166/thumb.jpg' srcset='/static/31958cb12c7783308ab97975cce20703/f93b5/thumb.jpg 300w,\n/static/31958cb12c7783308ab97975cce20703/b4294/thumb.jpg 600w,\n/static/31958cb12c7783308ab97975cce20703/e5166/thumb.jpg 1200w,\n/static/31958cb12c7783308ab97975cce20703/d165a/thumb.jpg 1400w' sizes='(max-width: 1200px) 100vw, 1200px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>Photo by https://unsplash.com/@huntleytography</figcaption>\n  </figure></p>\n<p><em>This is based on my experience and it may not work for your machine. Please use it at your own risk. I cannot take responsibility for any harm done to your computer.</em></p>\n<p>I have been very happy with my Conda virtual environment setup to do machine learning experiments locally, but as you probably already know, you cannot utilize AMD GPUs on Mac with Tensorflow. Most, if not all, ML frameworks only supports Nvidia GPUs. I have used PlaidML to get around this issue. When it worked, it worked great, but when it didn’t, it just didn’t. Then, I saw there was <a href=\"https://github.com/apple/tensorflow_macos\">a Github repo</a> that experimentally supported Mac GPU with Tensorflow, and only recently realized that now Apple started to support it more officially.</p>\n<p>In the link above, you will find the official instructions from Apple on how to install python packages to utilize your GPUs for both M1 and Intel-based Macs. You will also find <a href=\"https://developer.apple.com/forums/tags/tensorflow-metal\">many forum posts</a> on various issues people have encountered. In this post, I just want to share how I was able to install all the necessary softwares and test it on Jupyter notebook. But I don’t think my short post will cover every use case and every issue, so if you find something that I miss, please let me know, and I will try to update the post accordingly.</p>\n<p>I do not have M1-based Mac, so I will focus on installing on Intel-based 16-inch Macbook Pro model with AMD GPU that I have.</p>\n<h2>Python 3.8 — The only version that is supported</h2>\n<p>Before you follow <a href=\"https://developer.apple.com/metal/tensorflow-plugin/\">the official installation instructions</a>, you need to have python 3.8. That’s the only version that Apple’s plugin supports for Intel-based Macs at the time of writing.</p>\n<p>First, let’s open Terminal app. I am using a Conda environment by default, so I had to first deactivate it. I haven’t found a way to install the plugins using Conda yet.</p>\n<p>Run the command below only if you are already using Conda.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ conda deactivate</code></pre></div>\n<p>Then, check the current active python version by:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python --version</code></pre></div>\n<p>It should print python 3.8.x, and if it does, you can skip this part. But it’s more likely that it will print 2.x. If so, you will either have to newly install python 3.8 or switch to 3.8 that you already have on your system.</p>\n<h2>Newly install python 3.8</h2>\n<p>In terms of newly installing python 3.8, I am using brew as my main Mac package manager. Brew makes it very easy and fast to manage all kinds of softwares on your Mac. If you are not afraid of using Terminal commands, I highly recommend that you try it. Check the Brew website on how to install. The command below expects that you have already installed Brew.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew <span class=\"token function\">install</span> python@3.8</code></pre></div>\n<h2>Switch to python 3.8</h2>\n<p>Now let’s list all the python versions you have installed through Brew:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew list --formula <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> python</code></pre></div>\n<p>When I run the command above, I can see that I have both python 3.8 and 3.9. As I have said above, Apple Tensorflow plugins for Intel-based Macs only works with python 3.8. To use the python 3.8 as default, I had to run the commands below one at a time. You will have to restart the Terminal after running the commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew unlink python@3.9\n$ brew unlink python@3.8\n$ brew <span class=\"token function\">link</span> --force python@3.8</code></pre></div>\n<p>The steps below is a bit murky to me because I have already been using Brew and Python in different contexts, and have been playing around with them for some time. So I am not entirely sure what the setup will look like to a fresh machine. My apologies if this part is not clear to you. I will do my best, though.</p>\n<p>Let’s restart the Terminal app and check the python version again. In fact, there are two different commands for checking the current python version — pythonand python3 Run the commands one at a time.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python --version\n$ python3 --version</code></pre></div>\n<p>Do they all list as 3.8? Then, you are good to go, but if python --version shows you something other, then follow the steps below.</p>\n<p>First, let’s check all the versions that your system has:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ls</span> -l /usr/local/bin/python*</code></pre></div>\n<p>In my case, I can see that I have 3.8 at/usr/local/bin/python3.8 . So I will create a Symlink so that when I run <code class=\"language-text\">python</code> command, I am actually calling <code class=\"language-text\">python3</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ln</span> -s -f /usr/local/bin/python3.8 /usr/local/bin/python</code></pre></div>\n<p>Now, let’s check the python version one more time. It should print python 3.8 this time.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python --version\n$ python3 --version</code></pre></div>\n<p>If so, now we are finally ready to follow the Apple instructions!</p>\n<h2>Follow Apple Instructions</h2>\n<p>From <a href=\"https://developer.apple.com/metal/tensorflow-plugin/\">the Apple instructions page</a>, run the first command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python3 -m venv ~/tensorflow-metal</code></pre></div>\n<p>This will create a virtual environment at your user directory. Again, I have not found a way to do this with Conda yet.</p>\n<p>Now, run the second command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">source</span> ~/tensorflow-metal/bin/activate</code></pre></div>\n<p>This will activate the python3 (3.8) virtual environment. You will want to run this command every time you want to use this virtual environment. Just to be on the safe side, let’s check the python version again. Hopefully, it is still python 3.8!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python -V</code></pre></div>\n<p>Now, on to the third and last command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python -m pip <span class=\"token function\">install</span> -U pip</code></pre></div>\n<p><code class=\"language-text\">pip</code> will make it easy to install any python packages. The Step 2 and 3 below will install two different plugins. I saw from various posts that people ran into issues at these steps. In my case, when I made sure that I was using python 3.8, I was able to install them successfully. Run the commands below one at a time:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python -m pip <span class=\"token function\">install</span> tensorflow-macos\n$ python -m pip <span class=\"token function\">install</span> tensorflow-metal</code></pre></div>\n<h2>Install Additional Packages</h2>\n<p>This may be optional but because I like to work with Jupyter notebooks, I installed a few more packages:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python -m pip <span class=\"token function\">install</span> jupyter notebook jupyterlab</code></pre></div>\n<p>Once everything is ready, in the same Terminal window, let’s run the Jupyter Lab by:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ jupyter lab</code></pre></div>\n<p>This will automatically open up Jupyter Lab in a new browser tab.</p>\n<h2>Check GPU Device</h2>\n<p>The last step will be to see whether Tensorflow can now see the AMD GPU device. Run the following python code in your notebook cell:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\ndevices <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>list_physical_devices<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>devices<span class=\"token punctuation\">)</span></code></pre></div>\n<p>I can now see both CPU and GPU listed as physical devices, which is very exciting! I have not really done any performance testing yet so can’t say anything in that regard.</p>\n<p>I hope you find my post useful, and I will leave a few useful links below:</p>\n<ul>\n<li><a href=\"https://dev.to/malwarebo/how-to-set-python3-as-a-default-python-version-on-mac-4jjf\">https://dev.to/malwarebo/how-to-set-python3-as-a-default-python-version-on-mac-4jjf</a></li>\n<li><a href=\"https://developer.apple.com/metal/tensorflow-plugin/\">https://developer.apple.com/metal/tensorflow-plugin/</a></li>\n<li><a href=\"https://developer.apple.com/forums/tags/tensorflow-metal\">https://developer.apple.com/forums/tags/tensorflow-metal</a></li>\n</ul>","excerpt":"This is based on my experience and it may not work for your machine. Please use it at your own risk. I cannot take responsibility for any…","frontmatter":{"slug":"/blog/tensorflow-metal-intel-mac-gpu/","title":"Install Tensorflow Metal on Intel Macbook Pro with AMD GPU","subtitle":"Use Tensorflow with GPUs on Mac with the official Apple plugins.","date":"August 23, 2021","tags":["python","machine learning","tensorflow","mac","gpu"],"featuredImage":{"publicURL":"/static/31958cb12c7783308ab97975cce20703/thumb.jpg"}}}},"pageContext":{"slug":"/blog/tensorflow-metal-intel-mac-gpu/"}},
    "staticQueryHashes": ["1139398070","1696241065"]}